<div class="analyze-container">
  <mat-card class="analyze-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>psychology</mat-icon>
        Sentiment Analysis - Text
      </mat-card-title>
      <mat-card-subtitle> Analyze the sentiment and emotions of any text </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="input-section">
        <mat-form-field class="full-width" appearance="outline">
          <mat-label>Text to analyze</mat-label>
          <textarea
            matInput
            [(ngModel)]="inputText"
            rows="6"
            placeholder="Enter the text you want to analyze..."
            [disabled]="isAnalyzing()"
          >
          </textarea>
          <mat-hint>{{ inputText.length }}/2000 characters</mat-hint>
        </mat-form-field>

        <div class="actions">
          <button
            mat-raised-button
            color="primary"
            (click)="analyzeText()"
            [disabled]="isAnalyzing() || !inputText.trim()"
          >
            @if (isAnalyzing()) {
            <mat-spinner diameter="20"></mat-spinner>
            } @else {
            <mat-icon>analytics</mat-icon>
            } Analyze Sentiment
          </button>

          <button mat-button (click)="clearText()" [disabled]="isAnalyzing()">Clear</button>
        </div>
      </div>

      @if (result()) {
      <div class="result-section">
        <h3>Analysis Result</h3>

        <div class="sentiment-summary">
          <div class="sentiment-badge" [class]="'sentiment-' + result()!.sentiment">
            <mat-icon>{{ getSentimentIcon(result()!.sentiment) }}</mat-icon>
            <span class="sentiment-label">{{ result()!.sentiment | titlecase }}</span>
            <span class="sentiment-score">{{ result()!.score * 100 | number : '1.1-1' }}%</span>
          </div>

          <div class="confidence-info">
            <span class="confidence-label">Confidence:</span>
            <div class="confidence-bar">
              <div
                class="confidence-fill"
                [style.width.%]="result()!.confidence * 100"
                [class]="'confidence-' + getConfidenceLevel(result()!.confidence)"
              ></div>
            </div>
            <span class="confidence-value"
              >{{ result()!.confidence * 100 | number : '1.0-0' }}%</span
            >
          </div>
        </div>

        @if (result()!.emotions) {
        <div class="emotions-section">
          <h4>Emotional Breakdown</h4>
          <div class="emotions-grid">
            <div class="emotion-item">
              <mat-icon class="emotion-joy">sentiment_very_satisfied</mat-icon>
              <span>Joy: {{ result()!.emotions!.joy * 100 | number : '1.0-0' }}%</span>
            </div>
            <div class="emotion-item">
              <mat-icon class="emotion-anger">sentiment_very_dissatisfied</mat-icon>
              <span>Anger: {{ result()!.emotions!.anger * 100 | number : '1.0-0' }}%</span>
            </div>
            <div class="emotion-item">
              <mat-icon class="emotion-fear">warning</mat-icon>
              <span>Fear: {{ result()!.emotions!.fear * 100 | number : '1.0-0' }}%</span>
            </div>
            <div class="emotion-item">
              <mat-icon class="emotion-sadness">sentiment_dissatisfied</mat-icon>
              <span>Sadness: {{ result()!.emotions!.sadness * 100 | number : '1.0-0' }}%</span>
            </div>
          </div>
        </div>
        }
      </div>
      } @if (error()) {
      <div class="error-section">
        <mat-icon color="warn">error</mat-icon>
        <p>{{ error() }}</p>
        <button mat-button color="primary" (click)="clearError()">Dismiss</button>
      </div>
      }
    </mat-card-content>
  </mat-card>
</div>
