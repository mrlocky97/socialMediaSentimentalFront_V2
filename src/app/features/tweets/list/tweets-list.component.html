<div class="tweets-container">
  <!-- Filters Section -->
  <mat-card class="filters-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>filter_list</mat-icon>
        Tweet Filters
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="filters-grid">
        <mat-form-field appearance="outline">
          <mat-label>Search</mat-label>
          <input
            matInput
            [(ngModel)]="searchTerm"
            placeholder="Search tweets..."
            (input)="onSearchChange()"
          />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Sentiment</mat-label>
          <mat-select [(ngModel)]="selectedSentiment" (selectionChange)="onFiltersChange()">
            <mat-option value="">All Sentiments</mat-option>
            <mat-option value="positive">Positive</mat-option>
            <mat-option value="neutral">Neutral</mat-option>
            <mat-option value="negative">Negative</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Sort By</mat-label>
          <mat-select [(ngModel)]="sortBy" (selectionChange)="onFiltersChange()">
            <mat-option value="createdAt">Date</mat-option>
            <mat-option value="likes">Likes</mat-option>
            <mat-option value="retweets">Retweets</mat-option>
            <mat-option value="sentiment">Sentiment</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="filter-actions">
          <button mat-raised-button color="primary" (click)="onRefresh()">
            <mat-icon>refresh</mat-icon>
            Refresh
          </button>
          <button mat-button (click)="onClearFilters()">Clear Filters</button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Stats Section -->
  <div class="stats-grid">
    <div class="stat-card positive">
      <div class="stat-value">{{ tweetMetrics().positive }}</div>
      <div class="stat-label">Positive</div>
    </div>
    <div class="stat-card neutral">
      <div class="stat-value">{{ tweetMetrics().neutral }}</div>
      <div class="stat-label">Neutral</div>
    </div>
    <div class="stat-card negative">
      <div class="stat-value">{{ tweetMetrics().negative }}</div>
      <div class="stat-label">Negative</div>
    </div>
    <div class="stat-card total">
      <div class="stat-value">{{ totalTweets() }}</div>
      <div class="stat-label">Total Tweets</div>
    </div>
  </div>

  <!-- Tweets List -->
  <div class="tweets-list">
    @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading tweets...</p>
    </div>
    } @else if (isEmpty()) {
    <div class="empty-container">
      <mat-icon>article</mat-icon>
      <h3>No tweets found</h3>
      <p>Try adjusting your filters or refresh the data.</p>
      <button mat-raised-button color="primary" (click)="onRefresh()">Refresh Tweets</button>
    </div>
    } @else { @for (tweet of tweets(); track tweet.id) {
    <mat-card class="tweet-card">
      <mat-card-header>
        <div mat-card-avatar class="tweet-avatar">
          @if (tweet.author.profileImageUrl) {
          <img [src]="tweet.author.profileImageUrl" [alt]="tweet.author.displayName" />
          } @else {
          <mat-icon>person</mat-icon>
          }
        </div>
        <mat-card-title>{{ tweet.author.displayName }}</mat-card-title>
        <mat-card-subtitle>
          &#64;{{ tweet.author.username }} â€¢ {{ tweet.createdAt | date : 'short' }}
        </mat-card-subtitle>

        @if (tweet.sentiment) {
        <div class="sentiment-indicator" [class]="'sentiment-' + tweet.sentiment.label">
          <mat-icon>{{ getSentimentIcon(tweet.sentiment.label) }}</mat-icon>
          <span>{{ tweet.sentiment.label | titlecase }}</span>
        </div>
        }
      </mat-card-header>

      <mat-card-content>
        <p class="tweet-text">{{ tweet.text }}</p>

        @if (tweet.hashtags.length > 0) {
        <div class="hashtags">
          @for (hashtag of tweet.hashtags; track hashtag) {
          <mat-chip class="hashtag-chip">#{{ hashtag }}</mat-chip>
          }
        </div>
        } @if (tweet.mentions.length > 0) {
        <div class="mentions">
          @for (mention of tweet.mentions; track mention) {
          <mat-chip class="mention-chip">{{ mention }}</mat-chip>
          }
        </div>
        }
      </mat-card-content>

      <mat-card-actions>
        <div class="tweet-metrics">
          <span class="metric">
            <mat-icon>favorite_border</mat-icon>
            {{ tweet.metrics.likes | number }}
          </span>
          <span class="metric">
            <mat-icon>repeat</mat-icon>
            {{ tweet.metrics.retweets | number }}
          </span>
          <span class="metric">
            <mat-icon>chat_bubble_outline</mat-icon>
            {{ tweet.metrics.replies | number }}
          </span>
          @if (tweet.metrics.views) {
          <span class="metric">
            <mat-icon>visibility</mat-icon>
            {{ tweet.metrics.views | number }}
          </span>
          }
        </div>

        <div class="tweet-actions">
          <button mat-icon-button>
            <mat-icon>share</mat-icon>
          </button>
          <button mat-icon-button>
            <mat-icon>bookmark_border</mat-icon>
          </button>
        </div>
      </mat-card-actions>
    </mat-card>
    }

    <!-- Pagination -->
    <mat-paginator
      [length]="totalTweets()"
      [pageSize]="pageSize"
      [pageSizeOptions]="[10, 25, 50, 100]"
      [pageIndex]="currentPage() - 1"
      (page)="onPageChange($event)"
      showFirstLastButtons
    >
    </mat-paginator>
    }
  </div>
</div>
