<!-- =====================================
     OPTIMIZED DASHBOARD HOME COMPONENT
     Improved structure and performance
     ===================================== -->

<div class="home-dashboard">
  <!-- Dashboard Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="welcome-section">
        <h1 class="welcome-title">{{ 'dashboard.welcome' | transloco }}</h1>
        <p class="welcome-subtitle">{{ 'dashboard.subtitle' | transloco }}</p>
      </div>
    </div>
  </header>

  <!-- Dashboard Widgets Grid -->
  <div class="dashboard-grid">
    <!-- Widget Container Template -->
    <ng-template #authRequiredCard let-title="title" let-icon="icon" let-message="message">
      <mat-card class="auth-required-card">
        <mat-card-header>
          <div mat-card-avatar class="auth-icon">
            <mat-icon>{{ icon }}</mat-icon>
          </div>
          <mat-card-title>{{ title | transloco }}</mat-card-title>
          <mat-card-subtitle>{{ 'dashboard.auth_required' | transloco }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p class="auth-message">{{ message | transloco }}</p>
          <button
            mat-raised-button
            color="primary"
            (click)="handleNavigation('/login')"
            class="login-cta"
          >
            <mat-icon>login</mat-icon>
            {{ 'login.title' | transloco }}
          </button>
        </mat-card-content>
      </mat-card>
    </ng-template>

    <!-- Campaign Summary Widget -->
    <div class="widget-container campaign-summary">
      @if (authService.isAuthenticated()) {
      <app-campaign-summary-widget></app-campaign-summary-widget>
      } @else {
      <ng-container
        *ngTemplateOutlet="
          authRequiredCard;
          context: {
            title: 'campaigns.summary.title',
            icon: 'lock_outline',
            message: 'dashboard.login_to_view_campaigns'
          }
        "
      ></ng-container>
      }
    </div>

    <!-- Analytics Preview Widget -->
    <div class="widget-container analytics-preview">
      <mat-card class="dashboard-stats-widget modern-card">
        <mat-card-header>
          <div mat-card-avatar class="stats-icon">
            <mat-icon>analytics</mat-icon>
          </div>
          <mat-card-title>{{ 'dashboard.analytics.title' | transloco }}</mat-card-title>
          <mat-card-subtitle>{{ 'dashboard.analytics.subtitle' | transloco }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          @if (dashboardService.isLoading()) {
          <div class="loading-container modern-loading">
            <div class="skeleton-stats">
              <div class="skeleton-item"></div>
              <div class="skeleton-item"></div>
              <div class="skeleton-item"></div>
              <div class="skeleton-item"></div>
            </div>
          </div>
          } @else {
          <div class="stats-grid modern-stats">
            <div class="stat-item">
              <div class="stat-icon-wrapper">
                <mat-icon class="stat-icon">forum</mat-icon>
              </div>
              <div class="stat-content">
                <div class="stat-number">
                  {{ this.homeService.formatNumber(getTotalTweetsFromCampaigns()) }}
                </div>
                <div class="stat-label">{{ 'dashboard.stats.total_tweets' | transloco }}</div>
              </div>
            </div>

            <div class="stat-item">
              <div
                class="stat-icon-wrapper sentiment"
                [class]="getSentimentClass(getAverageSentiment())"
              >
                <mat-icon class="stat-icon">{{
                  this.homeService.getSentimentIcon(getAverageSentiment())
                }}</mat-icon>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ (getAverageSentiment() * 100).toFixed(1) }}%</div>
                <div class="stat-label">{{ 'dashboard.stats.avg_sentiment' | transloco }}</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-icon-wrapper">
                <mat-icon class="stat-icon">campaign</mat-icon>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ getActiveCampaignsCount() }}</div>
                <div class="stat-label">{{ 'dashboard.stats.active_campaigns' | transloco }}</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-icon-wrapper">
                <mat-icon class="stat-icon">trending_up</mat-icon>
              </div>
              <div class="stat-content">
                <div class="stat-number">
                  {{ this.homeService.formatNumber(getEstimatedEngagement()) }}
                </div>
                <div class="stat-label">{{ 'dashboard.stats.engagement' | transloco }}</div>
              </div>
            </div>
          </div>
          }
        </mat-card-content>

        <mat-card-actions>
          <button
            mat-button
            [routerLink]="['/dashboard/analytics']"
            [disabled]="!authService.isAuthenticated()"
          >
            <mat-icon>analytics</mat-icon>
            {{ 'dashboard.viewFullAnalytics' | transloco }}
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <!-- Sentiment Analysis Widget -->
    <div class="widget-container sentiment-analysis">
      <mat-card class="dashboard-sentiment-widget modern-card">
        <mat-card-header>
          <div
            mat-card-avatar
            class="sentiment-icon"
            [class]="getSentimentClass(getAverageSentiment())"
          >
            <mat-icon>{{ this.homeService.getSentimentIcon(getAverageSentiment()) }}</mat-icon>
          </div>
          <mat-card-title>{{ 'dashboard.sentiment.title' | transloco }}</mat-card-title>
          <mat-card-subtitle>{{ 'dashboard.sentiment.subtitle' | transloco }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          @if (dashboardService.isLoading()) {
          <div class="loading-container modern-loading">
            <div class="skeleton-sentiment">
              <div class="skeleton-circle"></div>
              <div class="skeleton-bars">
                <div class="skeleton-bar"></div>
                <div class="skeleton-bar"></div>
                <div class="skeleton-bar"></div>
              </div>
            </div>
          </div>
          } @else {
          <div class="sentiment-breakdown modern-sentiment">
            <div class="sentiment-overview">
              <div class="overall-sentiment" [class]="getSentimentClass(getAverageSentiment())">
                <div class="sentiment-score">{{ (getAverageSentiment() * 100).toFixed(1) }}%</div>
                <div class="sentiment-label">{{ 'dashboard.sentiment.overall' | transloco }}</div>
              </div>
            </div>

            <div class="sentiment-details">
              <div class="sentiment-item positive">
                <div class="sentiment-icon-wrapper">
                  <mat-icon>sentiment_very_satisfied</mat-icon>
                </div>
                <div class="sentiment-info">
                  <span class="sentiment-percentage"
                    >{{ (getPositiveSentimentPercentage() * 100).toFixed(1) }}%</span
                  >
                  <span class="sentiment-label">{{
                    'dashboard.sentiment.positive' | transloco
                  }}</span>
                </div>
                <div class="sentiment-progress">
                  <div
                    class="progress-bar positive"
                    [style.width.%]="getPositiveSentimentPercentage() * 100"
                  ></div>
                </div>
              </div>

              <div class="sentiment-item neutral">
                <div class="sentiment-icon-wrapper">
                  <mat-icon>sentiment_neutral</mat-icon>
                </div>
                <div class="sentiment-info">
                  <span class="sentiment-percentage"
                    >{{ (getNeutralSentimentPercentage() * 100).toFixed(1) }}%</span
                  >
                  <span class="sentiment-label">{{
                    'dashboard.sentiment.neutral' | transloco
                  }}</span>
                </div>
                <div class="sentiment-progress">
                  <div
                    class="progress-bar neutral"
                    [style.width.%]="getNeutralSentimentPercentage() * 100"
                  ></div>
                </div>
              </div>

              <div class="sentiment-item negative">
                <div class="sentiment-icon-wrapper">
                  <mat-icon>sentiment_very_dissatisfied</mat-icon>
                </div>
                <div class="sentiment-info">
                  <span class="sentiment-percentage"
                    >{{ (getNegativeSentimentPercentage() * 100).toFixed(1) }}%</span
                  >
                  <span class="sentiment-label">{{
                    'dashboard.sentiment.negative' | transloco
                  }}</span>
                </div>
                <div class="sentiment-progress">
                  <div
                    class="progress-bar negative"
                    [style.width.%]="getNegativeSentimentPercentage() * 100"
                  ></div>
                </div>
              </div>
            </div>
          </div>
          }
        </mat-card-content>

        <mat-card-actions>
          <button
            mat-button
            [routerLink]="['/dashboard/sentiment']"
            [disabled]="!authService.isAuthenticated()"
          >
            <mat-icon>psychology</mat-icon>
            {{ 'dashboard.viewFullSentiment' | transloco }}
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>
